From a807e0095d7c89e47735cd9caa1a19a1489165c4 Mon Sep 17 00:00:00 2001
From: Vendula Poncova <vponcova@redhat.com>
Date: Fri, 29 Oct 2021 15:36:40 +0800
Subject: [PATCH] fix boot options generated by dracut module

Add the inst. prefix to the anaconda boot options

---
 dracut/parse-kickstart                               | 4 ++--
 tests/nosetests/dracut_tests/parse-kickstart_test.py | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/dracut/parse-kickstart b/dracut/parse-kickstart
index 9b55ad6..63e71de 100755
--- a/dracut/parse-kickstart
+++ b/dracut/parse-kickstart
@@ -171,7 +171,7 @@ class DracutURL(Url, DracutArgsMixin):
         if self.noverifyssl:
             args.append("rd.noverifyssl")
         if self.proxy:
-            args.append("proxy=%s" % self.proxy)
+            args.append("inst.proxy=%s" % self.proxy)
 
         return "\n".join(args)
 
@@ -267,7 +267,7 @@ class DracutDisplayMode(DisplayMode, DracutArgsMixin):
 class DracutBootloader(Bootloader, DracutArgsMixin):
     def dracut_args(self, args, lineno, obj):
         if self.extlinux:
-            return "extlinux"
+            return "inst.extlinux"
 
 # FUTURE: keymap, lang... device? selinux?
 
diff --git a/tests/nosetests/dracut_tests/parse-kickstart_test.py b/tests/nosetests/dracut_tests/parse-kickstart_test.py
index 9a5cdcd..4dd37c7 100644
--- a/tests/nosetests/dracut_tests/parse-kickstart_test.py
+++ b/tests/nosetests/dracut_tests/parse-kickstart_test.py
@@ -94,7 +94,7 @@ class ParseKickstartTestCase(BaseTestCase):
         self.assertEqual(len(lines), 3, lines)
         self.assertEqual(lines[0], "inst.repo=https://host.at.foo.com/path/to/tree", lines)
         self.assertEqual(lines[1], "rd.noverifyssl", lines)
-        self.assertEqual(lines[2], "proxy=http://localhost:8123", lines)
+        self.assertEqual(lines[2], "inst.proxy=http://localhost:8123", lines)
 
     def updates_test(self):
         with tempfile.NamedTemporaryFile(mode="w+t") as ks_file:
@@ -344,4 +344,4 @@ network --device=lo --vlanid=171 --interfacename=vlan171
             ks_file.flush()
             lines = self.execParseKickstart(ks_file.name)
 
-            self.assertEqual(lines[0], "extlinux", lines)
+            self.assertEqual(lines[0], "inst.extlinux", lines)
-- 
2.23.0

